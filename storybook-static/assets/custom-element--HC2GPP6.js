var re=Object.defineProperty;var ie=(e,s,t)=>s in e?re(e,s,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[s]=t;var Q=(e,s,t)=>(ie(e,typeof s!="symbol"?s+"":s,t),t),U=(e,s,t)=>{if(!s.has(e))throw TypeError("Cannot "+t)};var H=(e,s,t)=>(U(e,s,"read from private field"),t?t.call(e):s.get(e)),k=(e,s,t)=>{if(s.has(e))throw TypeError("Cannot add the same private member more than once");s instanceof WeakSet?s.add(e):s.set(e,t)},O=(e,s,t,l)=>(U(e,s,"write to private field"),l?l.call(e,t):s.set(e,t),t);var V=(e,s,t)=>(U(e,s,"access private method"),t);const _="http://www.w3.org/1999/XSL/Transform",I="http://www.w3.org/1999/xhtml",ce="http://exslt.org/common",b=(e,s)=>{var t;return(t=e.getAttribute)==null?void 0:t.call(e,s)},M=e=>e.nodeType===3,me=e=>typeof e=="string",de=e=>e&&typeof e.nodeType=="number",N=(e,s="",t=document)=>(l=>(s&&l.append(S(t.ownerDocument||t,s)),l))((t.ownerDocument||t).createElement(e)),S=(e,s)=>(e.ownerDocument||e).createTextNode(s),te=e=>{for(;e.firstChild;)e.firstChild.remove();return e},X=e=>(e.getAttributeNames().map(s=>e.removeAttribute(s)),te(e)),ue=e=>(e==null||e.setAttribute("xmlns:xsl",_),e),pe=e=>(e==null||e.setAttribute("xmlns:xhtml",I),ue(e)),Z=(e,s)=>{const t=e.ownerDocument.createElementNS(e.namespaceURI,s);for(let l of e.attributes)t.setAttribute(l.name,l.value);for(;e.firstChild;)t.append(e.firstChild);return t};function L(e){return new DOMParser().parseFromString(e,"application/xml")}function j(e){return new XMLSerializer().serializeToString(e)}function R(e,s,t,l){const n=p=>e.ownerDocument.createElement(p),h=((p,v,d)=>(v.append(d=n(p)),d))(s,e);return[...t].forEach(p=>h.append(l(p))),h}function he(e){return e.slot||(e.setAttribute||(e=N("span",e.textContent.replaceAll(`
`,""))),e.setAttribute("slot","")),e}function P(e,s,t){const l=typeof e;if(l==="function")debugger;if(l==="string")return N(s,e,t);if(l==="number")return N(s,""+e,t);if(e instanceof Array){const r=N("array");return e.map(h=>r.append(P(h,s,t))),r}const n=N(s,"",t);for(let r in e)de(e[r])||typeof e[r]=="function"||e[r]instanceof Window||(typeof e[r]!="object"?n.setAttribute(r,e[r]):n.append(P(e[r],r,t)));return n}function ee(e){if(C(e,"*",s=>[...s.childNodes].filter(t=>t.nodeType===3).forEach(t=>{if(t.parentNode.localName==="style")return;const l=t.data.matchAll(/{([^}]*)}/g);if(l){let n=0,r=p=>S(t,p||""),h=[];if([...l].forEach(p=>{p.index>n&&h.push(r(p.input.substring(n,p.index)));const v=e.querySelector("value-of").cloneNode();v.setAttribute("select",p[1]),h.push(v),n=p.index+p[0].length}),n<t.data.length&&h.push(r(t.data.substring(n,t.data.length))),h.length){for(let p of h)s.insertBefore(p,t);s.removeChild(t)}}})),"all"in e){let s=1;for(let t of e.all)t.setAttribute&&!t.tagName.startsWith("xsl:")&&t.setAttribute("data-dce-id",""+s++)}return e}function fe(e,s="xsl:stylesheet"){var W;if(e.tagName===s||((W=e.documentElement)==null?void 0:W.tagName)===s)return ee(e);const t=L(`<xsl:stylesheet version="1.0" xmlns:xsl="${_}" xmlns:xhtml="${I}" xmlns:exsl="${ce}" exclude-result-prefixes="exsl" >
        <xsl:output method="xml" />
        <xsl:template match="/"><dce-root xmlns="${I}"><xsl:apply-templates select="*"/></dce-root></xsl:template>
        <xsl:template match="*[name()='template']"><xsl:apply-templates mode="sanitize" select="*|text()"/></xsl:template>
        <xsl:template match="*"><xsl:apply-templates mode="sanitize" select="*|text()"/></xsl:template>
        <xsl:template match="*[name()='svg']|*[name()='math']"><xsl:apply-templates mode="sanitize" select="."/></xsl:template>
        <xsl:template mode="sanitize" match="*[count(text())=1 and count(*)=0]"><xsl:copy><xsl:apply-templates mode="sanitize" select="@*"/><xsl:value-of select="text()"></xsl:value-of></xsl:copy></xsl:template>
        <xsl:template mode="sanitize" match="xhtml:*[count(text())=1 and count(*)=0]"><xsl:element name="{local-name()}"><xsl:apply-templates mode="sanitize" select="@*"/><xsl:value-of select="text()"></xsl:value-of></xsl:element></xsl:template>
        <xsl:template mode="sanitize" match="*|@*"><xsl:copy><xsl:apply-templates mode="sanitize" select="*|@*|text()"/></xsl:copy></xsl:template>
        <xsl:template mode="sanitize" match="text()[normalize-space(.) = '']"/>
        <xsl:template mode="sanitize" match="text()"><dce-text><xsl:copy/></dce-text></xsl:template>
        <xsl:template mode="sanitize" match="xsl:value-of|*[name()='slot']"><dce-text><xsl:copy><xsl:apply-templates mode="sanitize" select="*|@*|text()"/></xsl:copy></dce-text></xsl:template>
        <xsl:template mode="sanitize" match="xhtml:*"><xsl:element name="{local-name()}"><xsl:apply-templates mode="sanitize" select="*|@*|text()"/></xsl:element></xsl:template>
    </xsl:stylesheet>`),l=new XSLTProcessor,n=(i=>{var f,g;C(i,"script",x=>x.remove());const a=i.content??((f=i.firstElementChild)==null?void 0:f.content)??i.body??i;Ee.forEach(x=>C(a,x,w=>we(w,a)));const u=((g=i.firstElementChild)==null?void 0:g.content)||i.content,c=x=>{const w=L("<xhtml/>"),$=w.importNode(x,!0);return w.replaceChild($,w.documentElement),pe($)};if(u){const x=N("div");return[...u.childNodes].map(w=>x.append(w.cloneNode(!0))),c(x)}return c(i.documentElement||i.body||i)})(e),r=L(`<xsl:stylesheet version="1.0"
        xmlns:xsl="${_}"
        xmlns:xhtml="${I}"
        xmlns:dce="urn:schemas-epa-wg:dce"
        xmlns:exsl="http://exslt.org/common"
        exclude-result-prefixes="exsl"
    >
    <xsl:template match="ignore">
        <xsl:choose>
            <xsl:when test="//attr">{//attr}</xsl:when>
            <xsl:otherwise>{def}</xsl:otherwise>
        </xsl:choose><xsl:value-of select="."></xsl:value-of></xsl:template>
    <xsl:template mode="payload"  match="attributes"></xsl:template>
    <xsl:template match="/">
        <xsl:apply-templates mode="payload" select="/datadom/attributes"/>
    </xsl:template>
    <xsl:template name="slot" >
        <xsl:param name="slotname" />
        <xsl:param name="defaultvalue" />
        <xsl:choose>
            <xsl:when test="//payload/*[@slot=$slotname]">
               <xsl:copy-of select="//payload/*[@slot=$slotname]"/>
            </xsl:when>
            <xsl:otherwise>
                <xsl:copy-of select="$defaultvalue"/>
            </xsl:otherwise>
        </xsl:choose>
    </xsl:template>
    <xsl:variable name="js-injected-body">
        <xsl:call-template name="slot" >
            <xsl:with-param name="slotname" select="''"/>
            <xsl:with-param name="defaultvalue"/>
        </xsl:call-template>
    </xsl:variable>
</xsl:stylesheet>`);l.importStylesheet(t);const h=l.transformToFragment(n,document),p=(i,a)=>i.querySelector(a),v=p(r,'template[mode="payload"]');if(!h)return console.error("transformation error",{xml:n.outerHTML,xsl:j(t)});const d=[];[...h.querySelectorAll("dce-root>attribute")].forEach(i=>{var g;const a=Z(i,"xsl:param"),u=b(i,"name");v.append(a);let c=(g=b(a,"select"))==null?void 0:g.split("??");c||(c=["//"+u,`'${a.textContent}'`],X(a),a.setAttribute("name",u));let f;if((c==null?void 0:c.length)>1){a.removeAttribute("select");const x=p(r,'template[match="ignore"]>choose').cloneNode(!0);X(x.firstElementChild).append(S(x,"{"+c[0]+"}")),X(x.lastElementChild).append(S(x,"{"+c[1]+"}")),x.firstElementChild.setAttribute("test",c[0]),a.append(x),f=x.cloneNode(!0)}else f=Z(i,"xsl:value-of");f.removeAttribute("name"),i.append(f),i.removeAttribute("select"),d.push(a)}),[...h.querySelectorAll("[value]")].filter(i=>i.getAttribute("value").match(/\{(.*)\?\?(.*)\}/g)).forEach(i=>{const a=b(i,"value");a&&i.setAttribute("value",Ae(a))});for(const i of h.childNodes)v.append(r.importNode(i,!0));[...v.querySelectorAll("template")].forEach(i=>v.ownerDocument.documentElement.append(i));const z=p(r,'call-template[name="slot"]'),E=i=>{const a=z.cloneNode(!0),u=b(i,"name")||"";u&&a.firstElementChild.setAttribute("select",`'${u}'`);for(let c of i.childNodes)a.lastElementChild.append(c);return a};C(v,"slot",i=>i.parentNode.replaceChild(E(i),i));const T=ee(r);return T.params=d,T}async function xe(e){return await new Promise((t,l)=>{const n=new XMLHttpRequest;n.open("GET",e),n.responseType="document",n.onload=()=>{n.readyState===n.DONE&&n.status===200&&t(n.responseXML||N("div",n.responseText)),l(n.statusText)},n.addEventListener("error",r=>l(r)),n.send()})}const be=(e,s)=>s.split("|").map(t=>t.trim()).map(t=>{if(t.includes("/")){const l=[],n=e.ownerDocument.evaluate(t,e);for(let r;r=n.iterateNext();)l.push(r);return l}return[...e.childNodes].find(l=>l.localName===t)||N(t)}).flat();function ye(e,s,t,l){be(e,s).map(n=>{const r=e.ownerDocument,h=t.sliceEventSource,p=t.sliceElement,v=()=>[...n.childNodes].filter(d=>d.nodeType===3||d.localName==="value").map(d=>d.remove());if(h.getAttributeNames().map(d=>n.setAttribute(d,b(h,d))),[...n.childNodes].filter(d=>d.localName==="event").map(d=>d.remove()),t.type==="init"&&v(),n.append(P(t,"event",r)),p.hasAttribute("slice-value")){h.value===void 0?n.removeAttribute("value"):n.setAttribute("value",h.value);const d=ae(b(p,"slice-value"),n);v(),n.append(S(r,d))}else{const d=h.value??b(p,"value");v(),d==null?[...n.childNodes].filter(A=>A.localName!=="event").map(A=>A.remove()):me(d)?n.append(S(r,d)):n.append(P(d,"value",n.ownerDocument))}})}function C(e,s,t){e.querySelectorAll&&[...e.querySelectorAll(s)].forEach(t)}const se=(e,s)=>(t=>e===t?null:t&&(t.querySelector(s)||se(t,s)))(e.getRootNode()),ge=async(e,s)=>{if(!e||!e.trim())return[s];if(e.startsWith("#"))return(t=>{if(!t)return[];const l=t.querySelectorAll(e);if(l.length)return[...l];const n=t.getRootNode();return n===t?[]:se(n)})(s.parentElement);try{const t=await xe(e),l=new URL(e,location).hash;if(l){const n=t.querySelectorAll(l);return n.length?[...n]:[s]}return[t]}catch{return[s]}};function ve(e,s){if(M(e)){if(!M(s))debugger;return}for(let t of e.attributes)t.namespaceURI?s.setAttributeNS(t.namespaceURI,t.name,t.value):s.setAttribute(t.name,t.value),t.name==="value"&&(s.value=t.value)}function le(e,s=0){const t={};for(const l of e.childNodes){const n=b(l,"data-dce-id")||l.dceId||0;if(!t[n])n?t[n]=1:(t[n]=l.dceId=++s,l.setAttribute&&l.setAttribute("data-dce-id",l.dceId));else{const r=l.dceId=n+"-"+t[n]++;l.setAttribute&&l.setAttribute("data-dce-id",r)}l.childNodes.length&&le(l)}}function ne(e,s){if(!s.length)return te(e);const t={};for(let l of e.childNodes)t[l.dceId],M(l)?(l.data.trim(),t[l.dceId||0]=l):t[b(l,"data-dce-id")||0]=l;for(let l of[...s]){const n=b(l,"data-dce-id")||l.dceId,r=t[n];r?(M(l)?r.nodeValue!==l.nodeValue&&(r.nodeValue=l.nodeValue):(ve(l,r),(r.childNodes.length||l.childNodes.length)&&ne(r,l.childNodes)),delete t[n]):e.append(l)}for(let l of Object.values(t))l.remove()}function Ne(e,s){return e.hasAttribute(s)||e.setAttribute(s,crypto.randomUUID()),e.getAttribute(s)}const Ae=e=>[...e==null?void 0:e.matchAll(/([^{}]*)(\{)([^}]+)}([^{}]*)/g)].map(t=>`${t[1]}{${B(t[3])}}${t[4]}`).join(""),B=e=>{if(!e.trim())return e;const s=e.split("??"),t=s.shift(),l=B(s.join("??"));return s.length?`concat( ${t} , substring( ${l} , (1+string-length( ${l} )) * string-length( ${t} ) ) )`:e},ae=(e,s)=>{e=B(e);const t=s.ownerDocument.evaluate(e,s);switch(t.resultType){case XPathResult.NUMBER_TYPE:return t.numberValue;case XPathResult.STRING_TYPE:return t.stringValue}let l="";for(let n;n=t.iterateNext();)l+=n.textContent;return l},Ee="stylesheet,transform,import,include,strip-space,preserve-space,output,key,decimal-format,namespace-alias,template,value-of,copy-of,number,apply-templates,apply-imports,for-each,sort,if,choose,when,otherwise,attribute-set,call-template,with-param,variable,param,text,processing-instruction,element,attribute,comment,copy,message,fallback".split(","),we=(e,s)=>{const t=N("xsl:"+e.localName);for(let l of e.attributes)t.setAttribute(l.name,l.value);for(;e.firstChild;)t.append(e.firstChild);if(e.parentElement)e.parentElement.replaceChild(t,e);else{const l=e.parentElement||s,n=[...l.childNodes];n.forEach((r,h)=>{r===e&&(n[h]=t)}),l.replaceChildren(...n)}};class oe extends HTMLElement{async connectedCallback(){var E,T,F;const s=await ge(b(this,"src"),this),t=b(this,"tag"),l=t||"dce-"+crypto.randomUUID();for(const a of s)C(a.templateNode||a.content||a,"style",u=>{const c=u.closest("slot"),f=c?`slot[name="${c.name}"]`:"";u.innerHTML=`${l} ${f}{${u.innerHTML}}`,this.append(u)});const n=s.map(a=>fe(a)),r=n.map((a,u)=>(u=new XSLTProcessor,u.importStylesheet(a),u));Object.defineProperty(this,"xsltString",{get:()=>n.map(a=>j(a)).join(`
`)});const h=this,p=[...this.templateNode.querySelectorAll("[slice]")],v=p.map(a=>b(a,"slice")).filter(a=>!a.includes("/")).filter((a,u,c)=>c.indexOf(a)===u),d=n.reduce((a,u)=>(u.params&&a.push(...u.params),a),[]),i=class i extends HTMLElement{constructor(){super(...arguments);k(this,T);k(this,E,0)}static get observedAttributes(){return d.map(c=>b(c,"name"))}connectedCallback(){var J;let c=this.childNodes;if(((J=this.firstElementChild)==null?void 0:J.tagName)==="TEMPLATE"){const m=this.firstElementChild;m.remove(),c=m.content.childNodes;for(const o of[...m.content.childNodes])if(o.localName==="style"){const y=Ne(this,"data-dce-style");o.innerHTML=`${l}[data-dce-style="${y}"]{${o.innerHTML}}`,m.insertAdjacentElement("beforebegin",o)}else o.nodeType===1?m.insertAdjacentElement("beforebegin",o):o.nodeType===3&&m.insertAdjacentText("beforebegin",o.data)}const f=L("<datadom/>").documentElement,g=(m,o="")=>(y=>(o&&y.append(S(f,o)),y))(f.ownerDocument.createElement(m));R(f,"payload",c,he),this.innerHTML="",R(f,"attributes",this.attributes,m=>g(m.nodeName,m.value)),R(f,"dataset",Object.keys(this.dataset),m=>g(m,this.dataset[m]));const x=R(f,"slice",v,m=>g(m,"")),w=m=>ae(m,x);this.xml=f;const $=[],G=()=>{const m={};for(let o;o=$.pop();){const y=b(o.sliceElement,"slice");m[y]||(ye(x,y,o),m[y]=o)}Object.keys(m).length!==0&&Y()};let q;this.onSlice=m=>{var o;(o=m.stopPropagation)==null||o.call(m),m.sliceEventSource=m.currentTarget||m.target,$.push(m),q||(q=setTimeout(()=>{G(),q=0},10))};const Y=this.transform=()=>{if(H(this,E))debugger;O(this,E,1),r.map((o,y)=>{const D=o.transformToFragment(f.ownerDocument,document);return D||console.error(`XSLT transformation error. xsl:
`,j(n[y]),`
xml:
`,j(f)),D}).map(o=>{o&&(le(o),ne(this,o.childNodes))}),i.observedAttributes.map(o=>{let y=b(this.firstElementChild,o);y!==b(this,o)&&(this.setAttribute(o,y),V(this,T,F).call(this,o,y))}),C(this,"[slice]",o=>{if(!o.dceInitialized){o.dceInitialized=1;const y=b(o,"slice-event");(y||"change").split(" ").forEach(D=>(o.localName==="slice"?o.parentElement:o).addEventListener(D,K=>{K.sliceElement=o,this.onSlice(K)})),(!y||y.includes("init"))&&(o.hasAttribute("slice-value")||o.hasAttribute("value")||o.value?this.onSlice({type:"init",target:o,sliceElement:o}):o.value=w(b(o,"slice")))}}),O(this,E,0)};Y(),G()}attributeChangedCallback(c,f,g){!this.xml||H(this,E)||(V(this,T,F).call(this,c,g),this.transform())}get dce(){return h}};E=new WeakMap,T=new WeakSet,F=function(c,f){let g=this.xml.querySelector(`attributes>${c}`);g?X(g).append(S(g,f)):(g=N(c,f,this.xml),this.xml.querySelector("attributes").append(g))};let A=i;const z=a=>{window.customElements.get(a)!==A&&window.customElements.define(a,A)};if(t)z(t);else{const a=l;this.setAttribute("tag",a),z(a);const u=document.createElement(a);this.getAttributeNames().forEach(c=>u.setAttribute(c,this.getAttribute(c))),u.append(...[...this.childNodes].filter(c=>c.localName!=="style")),this.append(u)}}get templateNode(){var s;return((s=this.firstElementChild)==null?void 0:s.tagName)==="TEMPLATE"?this.firstElementChild.content:this}get dce(){return this}get xslt(){return L(this.xsltString)}}Q(oe,"observedAttributes",["src","tag","hidden"]);window.customElements.define("custom-element",oe);
