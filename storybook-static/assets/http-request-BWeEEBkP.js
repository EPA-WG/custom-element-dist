const o=(l,e)=>l.getAttribute(e);class u extends HTMLElement{static observedAttributes=["value","slice","url","method","header-accept"];get requestHeaders(){const e={};return[...this.attributes].filter(t=>t.name.startsWith("header-")).map(t=>e[t.name.substring(7)]=t.value),e}get requestProps(){const e={};return[...this.attributes].filter(t=>!t.name.startsWith("header-")).filter(t=>!t.name.startsWith("slice")).map(t=>e[t.name]=t.value),e}disconnectedCallback(){this.#t?.()}connectedCallback(){setTimeout(()=>this.fetch(),0)}#e="";#t=()=>{};async fetch(){if(!this.closest("body"))return;const e=o(this,"url")||"";if(!e)return this.#t?.(),this.value={};if(this.#e===e)return;this.#e=e;const t=new AbortController;this.#t=()=>{t.abort(this.localName+" disconnected"),this.#e=""};const a={...this.requestProps,headers:this.requestHeaders},i={request:a},n=()=>this.dispatchEvent(new Event("change"));this.value=i,n();const c=await fetch(e,{...this.requestProps,signal:t.signal,headers:this.requestHeaders}),r={headers:{}};if([...c.headers].map(([s,h])=>r.headers[s]=h),"ok,status,statusText,type,url,redirected".split(",").map(s=>r[s]=c[s]),i.response=r,n(),r.headers["content-type"]?.includes("json"))try{i.data=await c.json(),n()}catch{}if(r.headers["content-type"]?.includes("xml"))try{const s=await c.text(),h=new DOMParser;i.data=h.parseFromString(s,"application/xml")?.documentElement,n()}catch{}}attributeChangedCallback(e,t,a){e==="url"&&t!==a&&(t&&this.#t?.(),a?setTimeout(()=>this.fetch(),10):(this.value={},setTimeout(()=>this.dispatchEvent(new Event("change")),10)))}}window.customElements.define("http-request",u);
